<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="https://codepen.io/YoungHee/pen/pZGBBM.css">
</head>

<body width="100%">
    <h3>JS <-> APP</h3>

    <div class="container">
        <ul>
            <li>
                <button class="btn btn-submit" onclick="button_signin(`kakao`);">Sign In Kakao</button>
            </li>
            <li>
                <button class="btn btn-submit" onclick="button_signin(`naver`);">Sign In Naver</button>
            </li>
            <li>
                <button class="btn btn-submit" onclick="logout();">Logout</button>
            </li>
        </ul>
    </div>

    <h3>로컬에 있는 이미지를 바로 브라우저에 표시</h3>
    <img id="preview" src="" width="200px" alt="로컬에 있는 이미지가 보여지는 영역">
    <input type="file" id="getfile" accept="image/*">
        
        <script>
      var file = document.querySelector('#getfile');

file.onchange = function () {
  var fileList = file.files;
 
  // 읽기
  var reader = new FileReader();
  reader.readAsDataURL(fileList[0]);

  //로드 한 후
  reader.onload = function () {
    document.querySelector('#preview').src = reader.result;
  };
};

function button_signin(loginType) {
   var message = {
     command: 'requestSNSLogin',
     value: loginType
  };
  window.webkit.messageHandlers.dragon.postMessage(message);
}

function loginSuccess(result) {
  alert(result);
 var message = {
     command: 'requestRegisterPushToken'
  };  
  window.webkit.messageHandlers.dragon.postMessage(message);
}

function updatePushToken(token) {
  alert('token : ' + token);
}

function logout() {
  alert('로그아웃 요청');
 var message = {
     command: 'requestLogout'
  };
  window.webkit.messageHandlers.dragon.postMessage('');
}
            
const dragonNative = ((_) => {
  if (typeof window === 'undefined') {
    // SSR일 때 작동하지 않도록 방어
    return;
  }
  const iOSHandlerName = 'dragon';
  const iOSDomain = 'leisure';
  const iOSHandler = ((_) => {
    let tWebkit;
    let tHandler;
    let tiOSHandler;
    if (
      !!(tWebkit = window['webkit']) &&
      !!(tHandler = tWebkit.messageHandlers) &&
      !!(tiOSHandler = tHandler[iOSHandlerName])
    ) {
      return tiOSHandler;
    }
  })();
  const isNativeIOS = !!iOSHandler;
  const iOSAdapter = {
    type: 'IOS',
    requestSNSLogin: (param) => {
      iOSHandler.postMessage({ command : "requestSNSLogin", value : param});
    },
  };

  const androidHandlerName = 'dragon';
  const androidHandler = ((_) => {
    let tAndroidHandler;
    if (!!(tAndroidHandler = window[androidHandlerName])) {
      return tAndroidHandler;
    }
  })();
  const isNativeAndroid = !!androidHandler;
  const andoidAdapter = {
    type: 'ANDROID',
    requestSNSLogin: (param) => {
      androidHandler.requestSNSLogin(param);
    },
  };

  const webAdapter = {
    type: 'WEB',
    kinesis: (param) => {
      // 웹 클라이언트는 별거 없음
      console.log(param);
    },
  };

  let tDelegate;
  return new class {
    constructor(delegate) {
      tDelegate = delegate;
      console.log(`tDelegate.type: ${tDelegate.type}`);
    }
    get type() {
      if (!!tDelegate) return tDelegate.type;
      return 'WEB';
    }
    kinesis(param) {
      if (!!tDelegate) tDelegate.kinesis(param);
    }
  }(!!window ? isNativeIOS ? iOSAdapter : isNativeAndroid ? andoidAdapter : webAdapter : webAdapter);
});            
      //# sourceURL=pen.js
    </script>
</body>

</html>
